<!DOCTYPE html>
<html>
  <head>
    <title>LiFE Nextcloud Temp Sync</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self';">
    <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
  </head>
  
  <body class="d-flex flex-column align-items-center justify-content-start vh-100 bg-light pt-5">

    <!-- Nextcloud Logo -->
    <img src="icon.svg" alt="Nextcloud Icon" class="mb-4" width="100">
  
    <!-- Login Form -->
    <form id="loginForm" class="card shadow p-4 mb-3" style="width: 320px;" onsubmit="connect(); return false;">
        <h4 class="text-center mb-3">Nextcloud Login</h4>
      
        <div class="mb-3">
          <input type="text" id="server" class="form-control" value="https://cloud.xapient.solutions" placeholder="Server URL">
        </div>
      
        <div class="mb-3">
          <input type="text" id="username" class="form-control" placeholder="Username">
        </div>
      
        <div class="mb-3">
          <input type="password" id="password" class="form-control" placeholder="Password">
        </div>
      
        <button type="submit" class="btn btn-primary w-100">Verbinden</button>
    </form>
  
    <!-- fixed-height status div -->
    <div id="status" class="text-center" style="height: 2.5rem;"> <span class="text-muted">Nicht verbunden</span>  </div>

    <script>
        function connect(){
            const server   = document.getElementById("server").value
            const username = document.getElementById("username").value
            const password = document.getElementById("password").value

            ipcRenderer.invoke("login", { server, username, password }).then((answer) => {
                console.log("Backend Response:", answer)
            })
        }

        ipcRenderer.on("login-result", (event, result) => {
            const statusDiv = document.getElementById("status")
            if (result.status === "ok") {
                statusDiv.innerHTML = `<div class="alert alert-success">${result.message}</div>`
                 // disable form
                document.querySelectorAll("#loginForm input, #loginForm button").forEach(el => el.disabled = true)
            } 
            else {
                statusDiv.innerHTML = `<div class="alert alert-danger">${result.message}</div>`
            }
        })
    </script>
  </body>
</html>
