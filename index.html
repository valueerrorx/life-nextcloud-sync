<!DOCTYPE html>
<html>
  <head>
    <title>LiFE Nextcloud Sync</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self';">
    <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
  </head>
  
  <body class="d-flex flex-column align-items-center justify-content-start vh-100 bg-light pt-5">

    <!-- Nextcloud Logo -->
    <img src="icon.svg" alt="Nextcloud Icon" class="mb-4" width="100">
  
    <!-- Login Form -->
    <form id="loginForm" class="card shadow p-4 mb-3" style="width: 320px;" onsubmit="connect(); return false;">
        <h4 class="text-center mb-3">Nextcloud Login</h4>
      
        <div class="mb-3">
          <input type="text" id="server" class="form-control" value="https://cloud.xapient.solutions" placeholder="Server URL">
        </div>




        <div class="mb-3">
          <input type="text" id="username" class="form-control" placeholder="Username">
        </div>
      
        <div class="mb-3">
          <input type="password" id="password" class="form-control" placeholder="Password">
        </div>

        <!-- Sync Interval Slider -->
     
        <div class="mb-3 px-3">
            <label for="interval" class="form-label text-muted fs-7">
              Sync interval: <span id="intervalValue">4</span> minutes
            </label>
            <input 
              type="range" 
              class="form-range" 
              min="1" max="10" value="4" 
              id="interval" 
              oninput="updateIntervalValue(this.value)">
          </div>
          


        <button type="submit" class="btn btn-primary w-100">Verbinden</button>
    </form>
  
    <!-- fixed-height status div -->
    <div id="status" class="text-center" style="height: 2.5rem;">
      <span class="text-muted"></span>
    </div>

    <script>
        function updateIntervalValue(val){
            document.getElementById("intervalValue").textContent = val
        }

        function connect(){
            const server   = document.getElementById("server").value
            const username = document.getElementById("username").value
            const password = document.getElementById("password").value
            const interval = parseInt(document.getElementById("interval").value, 10)

            ipcRenderer.invoke("login", { server, username, password, interval }).then((answer) => {
                console.log("Backend Response:", answer)
            })
        }
        ipcRenderer.on("login-result", (event, result) => {
            const statusDiv = document.getElementById("status")
            const btn = document.querySelector("#loginForm button")

            if (result.status === "ok") {
                statusDiv.innerHTML = `<div class="alert alert-success">${result.message}</div>`
                document.querySelectorAll("#loginForm input").forEach(el => el.disabled = true)

                // change button look
                btn.textContent = "Verbunden"
                btn.classList.remove("btn-primary")
                btn.classList.add("btn-success")
                btn.disabled = true
            } 
            else {
                statusDiv.innerHTML = `<div class="alert alert-danger">${result.message}</div>`
            }
        })

    </script>
  </body>
</html>
